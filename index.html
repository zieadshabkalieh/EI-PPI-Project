<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


  <!-- Prevent browser caching -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma"        content="no-cache">
  <meta http-equiv="Expires"       content="0">

  <title>Environmental Index &amp; Performance Practicality Index (EI &amp; PPI)</title>

  <!-- Local CSS (cache-busted) -->
  <link rel="stylesheet" href="styles.css?v=20250427_9">
  <link rel="stylesheet" href="styles-dropdown.css?v=20250427_9">
  <link rel="stylesheet" href="styles-radio.css?v=20250427_9">
  <link rel="stylesheet" href="styles-reagent.css?v=20250427_9">
  <link rel="stylesheet" href="animations.css?v=20250427_9">
  <link rel="stylesheet" href="analytical-animations.css?v=20250427_9">
  <link rel="stylesheet" href="tab-watermarks.css?v=20250427_9">
  <link rel="stylesheet" href="mobile-responsive.css?v=20250427_9">
  <link rel="stylesheet" href="vendors/bootstrap.min.css?v=20250427_9">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">

  <!-- Service-Worker (single registration, only on http / https) -->
  <script>
    if ('serviceWorker' in navigator && location.protocol.startsWith('http')) {
      window.addEventListener('load', () =>
        navigator.serviceWorker.register('service-worker.js')
          .then(r => console.log('[SW] registered – scope:', r.scope))
          .catch(err => console.warn('[SW] registration failed', err))
      );
    }
  </script>

  <!-- Vendor JS (cache-busted) -->
  <script src="vendors/chart.min.js?v=20250427_9"></script>
  <script src="vendors/chartjs-plugin-annotation.min.js?v=20250427_9"></script>
  <script src="vendors/feather.min.js?v=20250427_9"></script>
  <script src="vendors/jspdf.umd.min.js?v=20250427_9"></script>
  <script src="vendors/exceljs.min.js?v=20250427_9"></script>
</head>

<body>
  <div id="app"></div>

  <!-- Main renderer bundle -->
  <script type="module" src="web-renderer.js?v=20250427_9"></script>

  <!-- Coxcomb-chart module (prevents 404) -->
  <!-- <script type="module" src="src/utils/CoxcombChart.js"></script> -->

  <!-- ------------- cache-bust helper ------------- -->
  <script>
    const CURRENT_VERSION = '20250427_9';                // bump when /assets change

    function clearBrowserCache() {
      console.log('Clearing browser cache and reloading…');

      // legacy AppCache
      if (window.applicationCache && window.applicationCache.swapCache) {
        try { window.applicationCache.swapCache(); } catch (e) {}
      }

      // clear SW caches
      if (window.caches) {
        caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
      }

      // meta tags for extra paranoia
      [['Cache-Control','no-cache, no-store, must-revalidate'],
       ['Pragma','no-cache'],
       ['Expires','0']].forEach(([h,v])=>{
         const m=document.createElement('meta');
         m.httpEquiv=h; m.content=v; document.head.appendChild(m);
       });

      // wipe localStorage “cache_*”
      Object.keys(localStorage).filter(k=>k.startsWith('cache_')).forEach(k=>localStorage.removeItem(k));

      localStorage.setItem('last_update', CURRENT_VERSION);

      // hard-reload with timestamp
      setTimeout(()=>{
        const ts = Date.now();
        if (location.search.includes('cache_bust=')) {
          location.href = location.href.replace(/cache_bust=\d+/, 'cache_bust='+ts);
        } else {
          location.href += (location.search ? '&' : '?') + 'cache_bust=' + ts;
        }
      }, 500);
    }

    if (localStorage.getItem('last_update') !== CURRENT_VERSION) clearBrowserCache();
  </script>
</body>
</html>
